# CSI人体活动识别 - 使用指南

## 项目文件说明

### 1. `CSI活动识别基础知识.md`
详细的理论基础文档，包括CSI原理、活动识别方法、特征提取等内容。

### 2. `activity_recognition.py`
核心活动识别模块，包含：
- `CSIPreprocessor`: 数据预处理（滤波、去噪、归一化）
- `CSIFeatureExtractor`: 特征提取（时域、频域特征）
- `ActivityRecognizer`: 活动识别器（训练、预测、评估）

### 3. `csi_activity_integration.py`
整合脚本，连接PCAP读取和活动识别功能。

### 4. `read.py`
原有的PCAP读取和CSI解析模块（已更新中文注释和可视化功能）。

## 快速开始

### 方式1: 演示模式（使用合成数据）

```bash
python activity_recognition.py
```

这将运行一个完整的演示，展示：
- 数据预处理
- 特征提取
- 模型训练
- 性能评估
- 混淆矩阵可视化

### 方式2: 分析单个PCAP文件

```bash
python csi_activity_integration.py csi.pcap
```

这将：
- 读取PCAP文件
- 提取CSI数据
- 可视化CSI热力图和时序图
- 显示数据统计信息

### 方式3: 交互式训练和预测

```bash
python csi_activity_integration.py
```

然后按照提示：
1. 选择"收集训练数据并训练模型"
2. 依次输入每个活动的PCAP文件路径和标签
3. 系统自动训练模型并评估
4. 输入新的PCAP文件进行活动预测

## 使用流程

### 步骤1: 数据收集

为每种活动收集CSI数据：

```bash
# 示例：收集三种活动
# 1. 静止状态（站立不动5秒）-> static.pcap
# 2. 走动（在房间内来回走动）-> walking.pcap  
# 3. 挥手（大幅度挥手动作）-> waving.pcap
```

### 步骤2: 数据可视化

先可视化每个PCAP文件，观察CSI模式：

```python
from csi_activity_integration import load_csi_from_pcap, visualize_activity_data

csi_amp, _ = load_csi_from_pcap('static.pcap')
visualize_activity_data(csi_amp, title='静止')
```

### 步骤3: 训练模型

使用交互式脚本收集多个活动的数据并训练：

```bash
python csi_activity_integration.py

# 输入:
# 1 (选择训练模式)
# static.pcap -> 静止
# walking.pcap -> 走动
# waving.pcap -> 挥手
# done (完成输入)
```

系统会自动：
- 提取特征
- 划分训练/测试集
- 训练随机森林分类器
- 显示分类报告和混淆矩阵

### 步骤4: 预测新数据

训练完成后，可以预测新采集的数据：

```bash
# 在交互模式中选择预测
# 或直接使用代码：

from csi_activity_integration import load_csi_from_pcap
from activity_recognition import ActivityRecognizer

# 假设已有训练好的recognizer
csi_new, _ = load_csi_from_pcap('test.pcap')
prediction = recognizer.predict(csi_new)
print(f"预测活动: {prediction}")
```

## 高级用法

### 自定义参数

修改`activity_recognition.py`中的参数：

```python
# 调整滑动窗口大小和重叠率
recognizer = ActivityRecognizer()
recognizer.preprocessor.window_size = 150  # 更大的窗口
recognizer.preprocessor.overlap = 0.75     # 更多重叠

# 调整滤波器参数
recognizer.preprocessor.butter_lowpass_filter(
    data, cutoff=3, fs=100, order=4
)
```

### 使用不同分类器

```python
from sklearn.svm import SVC
from sklearn.neighbors import KNeighborsClassifier

# 在ActivityRecognizer类中替换分类器
recognizer.classifier = SVC(kernel='rbf', C=1.0)
# 或
recognizer.classifier = KNeighborsClassifier(n_neighbors=5)
```

### 特征选择

```python
from sklearn.decomposition import PCA

# 在训练前进行降维
pca = PCA(n_components=50)
X_reduced = pca.fit_transform(X)
```

## 性能优化建议

### 1. 数据质量
- 确保每个活动至少收集3-5分钟数据
- 在相同环境下收集所有活动数据
- 尽量减少其他人员干扰

### 2. 特征工程
- 选择对活动敏感的子载波
- 尝试不同的窗口大小
- 添加领域特定的特征

### 3. 模型调优
- 使用交叉验证
- 调整分类器超参数
- 尝试集成学习方法

### 4. 实时识别
- 减少窗口大小以降低延迟
- 使用更快的分类器（如决策树）
- 实现滑动窗口的增量更新

## 常见问题

### Q1: 模型准确率低？
- 增加训练数据量
- 检查不同活动的CSI是否有明显差异
- 尝试不同的特征或分类器
- 确保训练和测试环境一致

### Q2: 预测速度慢？
- 减少窗口重叠率
- 减少特征数量（特征选择）
- 使用更简单的分类器

### Q3: 不同环境下效果差？
- 在多个环境中收集训练数据
- 使用迁移学习技术
- 设计环境无关的特征

## 下一步改进

1. **深度学习**: 使用CNN或LSTM处理原始CSI数据
2. **在线学习**: 实现实时更新模型
3. **多人识别**: 区分不同人的活动
4. **细粒度识别**: 识别更复杂的活动（如不同手势）
5. **异常检测**: 检测跌倒等异常事件

## 依赖包安装

```bash
pip install numpy scipy scikit-learn matplotlib seaborn
```

## 参考资源

- 论文: WiFi CSI-based Human Activity Recognition
- 数据集: SignFi, Widar, WiAR
- 工具: scikit-learn, TensorFlow, PyTorch

## 联系与支持

如有问题，请参考`CSI活动识别基础知识.md`文档或查阅相关研究论文。
